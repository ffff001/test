<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Enhanced VPS Security (Linux) | Smile's Blog</title><meta name=keywords content><meta name=description content="Something to say Try to use the official minimum mirror installation system, the system provided by VPS merchants may not be good.
Avoid using the root user, try to use a normal user.
Use a firewall and allow only the ports you need.
Follow the principle of least privilege.
Install as little software as possible to meet your own needs.
Use SELinux or AppArmor, if you can.
SSH Without a doubt, this is the most important."><meta name=author content="Smile"><link rel=canonical href=https://gokoururi.com/posts/5/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.e85ad0406048e8176e1c7661b25d5c69297ddfe41dc4124cf75ecb99a4f7b3d1.js integrity="sha256-6FrQQGBI6BduHHZhsl1caSl93+QdxBJM917LmaT3s9E=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://gokoururi.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gokoururi.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gokoururi.com/favicon-32x32.png><link rel=apple-touch-icon href=https://gokoururi.com/apple-touch-icon.png><link rel=mask-icon href=https://gokoururi.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.101.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Enhanced VPS Security (Linux)"><meta property="og:description" content="Something to say Try to use the official minimum mirror installation system, the system provided by VPS merchants may not be good.
Avoid using the root user, try to use a normal user.
Use a firewall and allow only the ports you need.
Follow the principle of least privilege.
Install as little software as possible to meet your own needs.
Use SELinux or AppArmor, if you can.
SSH Without a doubt, this is the most important."><meta property="og:type" content="article"><meta property="og:url" content="https://gokoururi.com/posts/5/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-14T12:55:25+08:00"><meta property="article:modified_time" content="2022-06-14T12:55:25+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Enhanced VPS Security (Linux)"><meta name=twitter:description content="Something to say Try to use the official minimum mirror installation system, the system provided by VPS merchants may not be good.
Avoid using the root user, try to use a normal user.
Use a firewall and allow only the ports you need.
Follow the principle of least privilege.
Install as little software as possible to meet your own needs.
Use SELinux or AppArmor, if you can.
SSH Without a doubt, this is the most important."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://gokoururi.com/posts/"},{"@type":"ListItem","position":2,"name":"Enhanced VPS Security (Linux)","item":"https://gokoururi.com/posts/5/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Enhanced VPS Security (Linux)","name":"Enhanced VPS Security (Linux)","description":"Something to say Try to use the official minimum mirror installation system, the system provided by VPS merchants may not be good.\nAvoid using the root user, try to use a normal user.\nUse a firewall and allow only the ports you need.\nFollow the principle of least privilege.\nInstall as little software as possible to meet your own needs.\nUse SELinux or AppArmor, if you can.\nSSH Without a doubt, this is the most important.","keywords":[],"articleBody":"Something to say Try to use the official minimum mirror installation system, the system provided by VPS merchants may not be good.\nAvoid using the root user, try to use a normal user.\nUse a firewall and allow only the ports you need.\nFollow the principle of least privilege.\nInstall as little software as possible to meet your own needs.\nUse SELinux or AppArmor, if you can.\nSSH Without a doubt, this is the most important.\n/etc/ssh/sshd_config Some configuration you need to modify.\n# Modify the default SSH port and try to use less commonly used ports. # If you don't know what port to modify, you can use \"shuf -i 1024-65545 -n 1\" to randomly pick one as your SSH port. # You should use a firewall (e.g. ufw) to limit the frequency of connections to the SSH port. Like this: \"ufw limit 17472/tcp\". # Install fail2ban. Port 17472 # Only use IPv6 to connect SSH, IPv6 can prevent large-scale network scanning due to its large number. (Optional) ListenAddress :: # You should disable root user login SSH. PermitRootLogin no # Disable SSH password login, you should log in using public key authentication. PasswordAuthentication no # Disable challenge-response passwords. ChallengeResponseAuthentication no # Usually not needed. X11Forwarding no # Specifies whether the distribution-specified extra version suffix is included during initial protocol handshake. I suggest to disable. DebianBanner no # Specifies the ciphers allowed. Use AEAD only, disable other encryption methods. Ciphers aes256-gcm@openssh.com,chacha20-poly1305@openssh.com # Specifies the available KEX (Key Exchange) algorithms. KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org # Specifies the available MAC (message authentication code) algorithms. MACs hmac-sha2-512-etm@openssh.com # Specifies the host key algorithms that the server offers. You should use ed25519, not rsa. HostKeyAlgorithms ssh-ed25519 # Allow only specified user groups to log in. AllowGroups sudo Reference Manpages (Debian)\nSecure Secure Shell\nComparison of cipher methods\nKernel (Optional) /etc/sysctl.conf # Turn on SYN-flood protections. net.ipv4.tcp_syncookies=1 # Disable Ping Replies. net.ipv4.icmp_echo_ignore_all=1 # Accept packets with SRR option? No net.ipv4.conf.all.accept_source_route=0 net.ipv4.conf.default.accept_source_route=0 net.ipv6.conf.all.accept_source_route=0 net.ipv6.conf.default.accept_source_route=0 # Accept Redirects? No, this is not router. net.ipv4.conf.all.accept_redirects=0 net.ipv6.conf.all.accept_redirects=0 net.ipv4.conf.default.accept_redirects=0 net.ipv6.conf.default.accept_redirects=0 net.ipv4.conf.all.secure_redirects=1 net.ipv4.conf.default.secure_redirects=1 # So no routing allowed. net.ipv4.conf.all.send_redirects=0 net.ipv4.conf.default.send_redirects=0 # Enable source validation by reversed path, as specified in RFC1812. net.ipv4.conf.all.rp_filter=1 net.ipv4.conf.default.rp_filter=1 # Controls the System Request debugging functionality of the kernel. kernel.sysrq=0 Reference nixCraft ","wordCount":"374","inLanguage":"en","datePublished":"2022-06-14T12:55:25+08:00","dateModified":"2022-06-14T12:55:25+08:00","author":{"@type":"Person","name":"Smile"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gokoururi.com/posts/5/"},"publisher":{"@type":"Organization","name":"Smile's Blog","logo":{"@type":"ImageObject","url":"https://gokoururi.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gokoururi.com/ accesskey=h title="Smile's Blog (Alt + H)">Smile's Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://gokoururi.com/ title=Home><span>Home</span></a></li><li><a href=https://gokoururi.com/archives title=Archives><span>Archives</span></a></li><li><a href=https://gokoururi.com/about title=About><span>About</span></a></li><li><a href=https://gokoururi.com/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gokoururi.com/>Home</a>&nbsp;»&nbsp;<a href=https://gokoururi.com/posts/>Posts</a></div><h1 class=post-title>Enhanced VPS Security (Linux)</h1><div class=post-meta><span title='2022-06-14 12:55:25 +0800 CST'>June 14, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Smile</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#something-to-say aria-label="Something to say">Something to say</a></li><li><a href=#ssh aria-label=SSH>SSH</a><ul><li><a href=#etcsshsshd_config aria-label=/etc/ssh/sshd_config>/etc/ssh/sshd_config</a><ul><li><a href=#reference aria-label=Reference>Reference</a></li></ul></li></ul></li><li><a href=#kernel-optional aria-label="Kernel (Optional)">Kernel (Optional)</a><ul><li><a href=#etcsysctlconf aria-label=/etc/sysctl.conf>/etc/sysctl.conf</a><ul><li><a href=#reference-1 aria-label=Reference>Reference</a></li></ul></li></ul></li></ul></div></details></div><div class=post-content><h1 id=something-to-say>Something to say<a hidden class=anchor aria-hidden=true href=#something-to-say>#</a></h1><ul><li><p>Try to use the official minimum mirror installation system, the system provided by VPS merchants may not be good.</p></li><li><p>Avoid using the root user, try to use a normal user.</p></li><li><p>Use a firewall and allow only the ports you need.</p></li><li><p>Follow the principle of least privilege.</p></li><li><p>Install as little software as possible to meet your own needs.</p></li><li><p>Use SELinux or AppArmor, if you can.</p></li></ul><h1 id=ssh>SSH<a hidden class=anchor aria-hidden=true href=#ssh>#</a></h1><p>Without a doubt, this is the most important.</p><h2 id=etcsshsshd_config>/etc/ssh/sshd_config<a hidden class=anchor aria-hidden=true href=#etcsshsshd_config>#</a></h2><p>Some configuration you need to modify.</p><pre tabindex=0><code># Modify the default SSH port and try to use less commonly used ports.
# If you don&#39;t know what port to modify, you can use &#34;shuf -i 1024-65545 -n 1&#34; to randomly pick one as your SSH port.
# You should use a firewall (e.g. ufw) to limit the frequency of connections to the SSH port. Like this: &#34;ufw limit 17472/tcp&#34;.
# Install fail2ban.
Port 17472

# Only use IPv6 to connect SSH, IPv6 can prevent large-scale network scanning due to its large number. (Optional)
ListenAddress ::

# You should disable root user login SSH.
PermitRootLogin no

# Disable SSH password login, you should log in using public key authentication.
PasswordAuthentication no

# Disable challenge-response passwords.
ChallengeResponseAuthentication no

# Usually not needed.
X11Forwarding no

# Specifies whether the distribution-specified extra version suffix is included during initial protocol handshake. I suggest to disable.
DebianBanner no

# Specifies the ciphers allowed. Use AEAD only, disable other encryption methods.
Ciphers aes256-gcm@openssh.com,chacha20-poly1305@openssh.com

# Specifies the available KEX (Key Exchange) algorithms.
KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org

# Specifies the available MAC (message authentication code) algorithms.
MACs hmac-sha2-512-etm@openssh.com

# Specifies the host key algorithms that the server offers. You should use ed25519, not rsa.
HostKeyAlgorithms ssh-ed25519

# Allow only specified user groups to log in.
AllowGroups sudo
</code></pre><h3 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h3><ul><li><p><a href=https://manpages.debian.org/bullseye/openssh-server/sshd_config.5.en.html>Manpages (Debian)</a></p></li><li><p><a href=https://stribika.github.io/2015/01/04/secure-secure-shell.html>Secure Secure Shell</a></p></li><li><p><a href=https://ssh-comparison.quendi.de/comparison/cipher.html>Comparison of cipher methods</a></p></li></ul><h1 id=kernel-optional>Kernel (Optional)<a hidden class=anchor aria-hidden=true href=#kernel-optional>#</a></h1><h2 id=etcsysctlconf>/etc/sysctl.conf<a hidden class=anchor aria-hidden=true href=#etcsysctlconf>#</a></h2><pre tabindex=0><code># Turn on SYN-flood protections.
net.ipv4.tcp_syncookies=1

# Disable Ping Replies.
net.ipv4.icmp_echo_ignore_all=1

# Accept packets with SRR option? No
net.ipv4.conf.all.accept_source_route=0
net.ipv4.conf.default.accept_source_route=0
net.ipv6.conf.all.accept_source_route=0
net.ipv6.conf.default.accept_source_route=0

# Accept Redirects? No, this is not router.
net.ipv4.conf.all.accept_redirects=0
net.ipv6.conf.all.accept_redirects=0
net.ipv4.conf.default.accept_redirects=0
net.ipv6.conf.default.accept_redirects=0
net.ipv4.conf.all.secure_redirects=1
net.ipv4.conf.default.secure_redirects=1

# So no routing allowed.
net.ipv4.conf.all.send_redirects=0
net.ipv4.conf.default.send_redirects=0

# Enable source validation by reversed path, as specified in RFC1812.
net.ipv4.conf.all.rp_filter=1
net.ipv4.conf.default.rp_filter=1

# Controls the System Request debugging functionality of the kernel.
kernel.sysrq=0
</code></pre><h3 id=reference-1>Reference<a hidden class=anchor aria-hidden=true href=#reference-1>#</a></h3><ul><li><a href=https://www.cyberciti.biz/faq/linux-kernel-etcsysctl-conf-security-hardening/>nixCraft</a></li></ul></div><footer class=post-footer><nav class=paginav><a class=next href=https://gokoururi.com/posts/4/><span class=title>Next Page »</span><br><span>Deploy WireGuard</span></a></nav></footer></article></main><footer class=footer><span>© 2020-2022 <a href=/>Smile&rsquo;s Blog</a> (<a href=/about/#license>License</a> under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>BY-NC-SA 4.0</a>)</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>