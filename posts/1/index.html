<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Use ACME to issue certificates | Smile's Blog</title><meta name=keywords content><meta name=description content="About acme.sh A pure Unix shell script implementing ACME client protocol.
Step Get ACME curl https://get.acme.sh | bash After getting ACME successfully, its path is ~/.acme.sh/.
It adds environment variable in ~/.bashrc.
Update your environment variables.
source ~/.bashrc Get DNS API I use Cloudflare as an example.
To get Cloudflare&rsquo;s DNS API, you should log in Cloudflare first.
At the top right, click My Profile.
Click on API Tokens on the left."><meta name=author content="Smile"><link rel=canonical href=https://gokoururi.com/posts/1/><link crossorigin=anonymous href=/assets/css/stylesheet.min.c88963fe2d79462000fd0fb1b3737783c32855d340583e4523343f8735c787f0.css integrity="sha256-yIlj/i15RiAA/Q+xs3N3g8MoVdNAWD5FIzQ/hzXHh/A=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.e85ad0406048e8176e1c7661b25d5c69297ddfe41dc4124cf75ecb99a4f7b3d1.js integrity="sha256-6FrQQGBI6BduHHZhsl1caSl93+QdxBJM917LmaT3s9E=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://gokoururi.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://gokoururi.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://gokoururi.com/favicon-32x32.png><link rel=apple-touch-icon href=https://gokoururi.com/apple-touch-icon.png><link rel=mask-icon href=https://gokoururi.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.101.0"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Use ACME to issue certificates"><meta property="og:description" content="About acme.sh A pure Unix shell script implementing ACME client protocol.
Step Get ACME curl https://get.acme.sh | bash After getting ACME successfully, its path is ~/.acme.sh/.
It adds environment variable in ~/.bashrc.
Update your environment variables.
source ~/.bashrc Get DNS API I use Cloudflare as an example.
To get Cloudflare&rsquo;s DNS API, you should log in Cloudflare first.
At the top right, click My Profile.
Click on API Tokens on the left."><meta property="og:type" content="article"><meta property="og:url" content="https://gokoururi.com/posts/1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-07-03T14:19:11+08:00"><meta property="article:modified_time" content="2021-07-03T14:19:11+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Use ACME to issue certificates"><meta name=twitter:description content="About acme.sh A pure Unix shell script implementing ACME client protocol.
Step Get ACME curl https://get.acme.sh | bash After getting ACME successfully, its path is ~/.acme.sh/.
It adds environment variable in ~/.bashrc.
Update your environment variables.
source ~/.bashrc Get DNS API I use Cloudflare as an example.
To get Cloudflare&rsquo;s DNS API, you should log in Cloudflare first.
At the top right, click My Profile.
Click on API Tokens on the left."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://gokoururi.com/posts/"},{"@type":"ListItem","position":2,"name":"Use ACME to issue certificates","item":"https://gokoururi.com/posts/1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Use ACME to issue certificates","name":"Use ACME to issue certificates","description":"About acme.sh A pure Unix shell script implementing ACME client protocol.\nStep Get ACME curl https://get.acme.sh | bash After getting ACME successfully, its path is ~/.acme.sh/.\nIt adds environment variable in ~/.bashrc.\nUpdate your environment variables.\nsource ~/.bashrc Get DNS API I use Cloudflare as an example.\nTo get Cloudflare\u0026rsquo;s DNS API, you should log in Cloudflare first.\nAt the top right, click My Profile.\nClick on API Tokens on the left.","keywords":[],"articleBody":"About acme.sh A pure Unix shell script implementing ACME client protocol.\nStep Get ACME curl https://get.acme.sh | bash After getting ACME successfully, its path is ~/.acme.sh/.\nIt adds environment variable in ~/.bashrc.\nUpdate your environment variables.\nsource ~/.bashrc Get DNS API I use Cloudflare as an example.\nTo get Cloudflare’s DNS API, you should log in Cloudflare first.\nAt the top right, click My Profile.\nClick on API Tokens on the left.\nThen you will see the global API key, click View next to it.\nEnter your password and pass hCaptcha, you will get API Key. Please protect your API Key and don’t leak it! If you leak it, please click Change next to View to replace the API Key.\nACMWE also supports other DNS, you can see it in ~/.acme.sh/dnsapi/.\nFor example dns_cf refers to Cloudflare.\nSet temporary environment variables Use export to set temporary environment variables.\nFill in the corresponding content in double quotation marks.\nCF_Key API Key you got in Cloudflare.\nCF_Email Your email at Cloudflare.\nexport CF_Key=\"\" export CF_Email=\"\" Change the default CA If you want to use Let’s Encrypt like me, you can use this command.\nACME’s default CA is ZeroSSL, if you want to continue using ZeroSSL, you don’t need to use this command.\nacme.sh --set-default-ca --server letsencrypt Issue certificates If you continue to use ZeroSSL, please use this command to register a ZeroSSL account.\nacme.sh --register-account -m your_email If you no longer use ZeroSSL account, you can use --deactivate-account to deactivate it.\nAbout the meaning of commands --issue Issue a cert.\n--dns [dns_hook] Use specified dns api.\n-d Specifies a domain, used to issue, renew or revoke etc.\n-k Specifies the domain key length: 2048, 3072, 4096, 8192 (RSA) or ec-256, ec-384, ec-521 (ECC).\n--ecc Specifies to use the ECC cert.\n-h Show this help message. You can use this command to see a full description of all commands.\nExample of command usage, if I want to use Cloudflare’s DNS API to issue an ECC certificate with a key length of 384, and this certificate is a wildcard.\nacme.sh --issue --dns dns_cf -d example.com -d *.example.com -k ec-384 When issuing the certificate, you only need to be able to connect to the Internet normally.\nIf the certificate is issued successfully, it will create a directory under ~/.acme.sh/.\nFor example the path to the certificate is ~/.acme.sh/example.com_ecc/.\nNormally, this directory will have these files.\nca.cer\nfullchain.cer\nexample.com.cer\nexample.com.conf\nexample.com.csr\nexample.com.csr.conf\nexample.com.key\nNormally, we would only use fullchain.cer and example.com.key.\nOther Some useful commands --upgrade Upgrade acme.sh to latest.\n--uninstall Uninstall acme.sh, and uninstall the cron job.\nRenewal certificate Manual renewal Normally, ACME automatically renews the certificate using cron, you don’t need to worry.\nIf you need to renew the certificate manually, you need to know these commands.\n-r Renew a cert.\n--renew-all Renew all the certs.\n--force You can force the renewal of the certificate.\nRevoked certificate You can revoke the certificate with this command.\n--revoke Revoke a cert. Certificate query You can query your certificate here.\ncrt.sh\nGoogle’s Certificate Transparency\n","wordCount":"507","inLanguage":"en","datePublished":"2021-07-03T14:19:11+08:00","dateModified":"2021-07-03T14:19:11+08:00","author":{"@type":"Person","name":"Smile"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://gokoururi.com/posts/1/"},"publisher":{"@type":"Organization","name":"Smile's Blog","logo":{"@type":"ImageObject","url":"https://gokoururi.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://gokoururi.com/ accesskey=h title="Smile's Blog (Alt + H)">Smile's Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://gokoururi.com/ title=Home><span>Home</span></a></li><li><a href=https://gokoururi.com/archives title=Archives><span>Archives</span></a></li><li><a href=https://gokoururi.com/about title=About><span>About</span></a></li><li><a href=https://gokoururi.com/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://gokoururi.com/>Home</a>&nbsp;»&nbsp;<a href=https://gokoururi.com/posts/>Posts</a></div><h1 class=post-title>Use ACME to issue certificates</h1><div class=post-meta><span title='2021-07-03 14:19:11 +0800 CST'>July 3, 2021</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Smile</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#about-acmesh aria-label="About acme.sh">About acme.sh</a></li><li><a href=#step aria-label=Step>Step</a><ul><li><a href=#get-acme aria-label="Get ACME">Get ACME</a></li><li><a href=#get-dns-api aria-label="Get DNS API">Get DNS API</a></li><li><a href=#set-temporary-environment-variables aria-label="Set temporary environment variables">Set temporary environment variables</a></li><li><a href=#change-the-default-ca aria-label="Change the default CA">Change the default CA</a></li><li><a href=#issue-certificates aria-label="Issue certificates">Issue certificates</a><ul><li><a href=#about-the-meaning-of-commands aria-label="About the meaning of commands">About the meaning of commands</a></li></ul></li></ul></li><li><a href=#other aria-label=Other>Other</a><ul><li><a href=#some-useful-commands aria-label="Some useful commands">Some useful commands</a></li><li><a href=#renewal-certificate aria-label="Renewal certificate">Renewal certificate</a><ul><li><a href=#manual-renewal aria-label="Manual renewal">Manual renewal</a></li></ul></li><li><a href=#revoked-certificate aria-label="Revoked certificate">Revoked certificate</a></li></ul></li><li><a href=#certificate-query aria-label="Certificate query">Certificate query</a></li></ul></div></details></div><div class=post-content><h1 id=about-acmesh>About acme.sh<a hidden class=anchor aria-hidden=true href=#about-acmesh>#</a></h1><p>A pure Unix shell script implementing <a href=https://github.com/acmesh-official/acme.sh/wiki>ACME</a> client protocol.</p><h1 id=step>Step<a hidden class=anchor aria-hidden=true href=#step>#</a></h1><h2 id=get-acme>Get ACME<a hidden class=anchor aria-hidden=true href=#get-acme>#</a></h2><pre tabindex=0><code>curl https://get.acme.sh | bash
</code></pre><p>After getting ACME successfully, its path is <code>~/.acme.sh/</code>.</p><p>It adds environment variable in <code>~/.bashrc</code>.</p><p>Update your environment variables.</p><pre tabindex=0><code>source ~/.bashrc
</code></pre><h2 id=get-dns-api>Get DNS API<a hidden class=anchor aria-hidden=true href=#get-dns-api>#</a></h2><p>I use Cloudflare as an example.</p><p>To get Cloudflare&rsquo;s DNS API, you should <a href=(https://dash.cloudflare.com/login)>log in</a> Cloudflare first.</p><ul><li><p>At the top right, click My Profile.</p></li><li><p>Click on API Tokens on the left.</p></li><li><p>Then you will see the global API key, click View next to it.</p></li><li><p>Enter your password and pass hCaptcha, you will get API Key. Please protect your API Key and don&rsquo;t leak it! If you leak it, please click Change next to View to replace the API Key.</p></li></ul><p>ACMWE also supports other DNS, you can see it in <code>~/.acme.sh/dnsapi/</code>.</p><p>For example <code>dns_cf</code> refers to Cloudflare.</p><h2 id=set-temporary-environment-variables>Set temporary environment variables<a hidden class=anchor aria-hidden=true href=#set-temporary-environment-variables>#</a></h2><p>Use <code>export</code> to set temporary environment variables.</p><p>Fill in the corresponding content in double quotation marks.</p><ul><li><p><code>CF_Key</code> API Key you got in Cloudflare.</p></li><li><p><code>CF_Email</code> Your email at Cloudflare.</p></li></ul><pre tabindex=0><code>export CF_Key=&#34;&#34;
export CF_Email=&#34;&#34;
</code></pre><h2 id=change-the-default-ca>Change the default CA<a hidden class=anchor aria-hidden=true href=#change-the-default-ca>#</a></h2><p>If you want to use <a href=https://letsencrypt.org>Let&rsquo;s Encrypt</a> like me, you can use this command.</p><p>ACME&rsquo;s default CA is <a href=https://zerossl.com>ZeroSSL</a>, if you want to continue using ZeroSSL, you don&rsquo;t need to use this command.</p><pre tabindex=0><code>acme.sh --set-default-ca --server letsencrypt
</code></pre><h2 id=issue-certificates>Issue certificates<a hidden class=anchor aria-hidden=true href=#issue-certificates>#</a></h2><p>If you continue to use ZeroSSL, please use this command to register a ZeroSSL account.</p><pre tabindex=0><code>acme.sh --register-account -m your_email
</code></pre><p>If you no longer use ZeroSSL account, you can use <code>--deactivate-account</code> to deactivate it.</p><h3 id=about-the-meaning-of-commands>About the meaning of commands<a hidden class=anchor aria-hidden=true href=#about-the-meaning-of-commands>#</a></h3><ul><li><p><code>--issue</code> Issue a cert.</p></li><li><p><code>--dns [dns_hook]</code> Use specified dns api.</p></li><li><p><code>-d</code> Specifies a domain, used to issue, renew or revoke etc.</p></li><li><p><code>-k</code> Specifies the domain key length: 2048, 3072, 4096, 8192 (RSA) or ec-256, ec-384, ec-521 (ECC).</p></li><li><p><code>--ecc</code> Specifies to use the ECC cert.</p></li><li><p><code>-h</code> Show this help message. You can use this command to see a full description of all commands.</p></li></ul><p>Example of command usage, if I want to use Cloudflare&rsquo;s DNS API to issue an ECC certificate with a key length of 384, and this certificate is a wildcard.</p><pre tabindex=0><code>acme.sh --issue --dns dns_cf -d example.com -d *.example.com -k ec-384
</code></pre><p>When issuing the certificate, you only need to be able to connect to the Internet normally.</p><p>If the certificate is issued successfully, it will create a directory under <code>~/.acme.sh/</code>.</p><p>For example the path to the certificate is <code>~/.acme.sh/example.com_ecc/</code>.</p><p>Normally, this directory will have these files.</p><ul><li><p>ca.cer</p></li><li><p>fullchain.cer</p></li><li><p>example.com.cer</p></li><li><p>example.com.conf</p></li><li><p>example.com.csr</p></li><li><p>example.com.csr.conf</p></li><li><p>example.com.key</p></li></ul><p>Normally, we would only use <code>fullchain.cer</code> and <code>example.com.key</code>.</p><h1 id=other>Other<a hidden class=anchor aria-hidden=true href=#other>#</a></h1><h2 id=some-useful-commands>Some useful commands<a hidden class=anchor aria-hidden=true href=#some-useful-commands>#</a></h2><ul><li><p><code>--upgrade</code> Upgrade acme.sh to latest.</p></li><li><p><code>--uninstall</code> Uninstall acme.sh, and uninstall the cron job.</p></li></ul><h2 id=renewal-certificate>Renewal certificate<a hidden class=anchor aria-hidden=true href=#renewal-certificate>#</a></h2><h3 id=manual-renewal>Manual renewal<a hidden class=anchor aria-hidden=true href=#manual-renewal>#</a></h3><p>Normally, ACME automatically renews the certificate using cron, you don&rsquo;t need to worry.</p><p>If you need to renew the certificate manually, you need to know these commands.</p><ul><li><p><code>-r</code> Renew a cert.</p></li><li><p><code>--renew-all</code> Renew all the certs.</p></li><li><p><code>--force</code> You can force the renewal of the certificate.</p></li></ul><h2 id=revoked-certificate>Revoked certificate<a hidden class=anchor aria-hidden=true href=#revoked-certificate>#</a></h2><p>You can revoke the certificate with this command.</p><ul><li><code>--revoke</code> Revoke a cert.</li></ul><h1 id=certificate-query>Certificate query<a hidden class=anchor aria-hidden=true href=#certificate-query>#</a></h1><p>You can query your certificate here.</p><ul><li><p><a href=https://crt.sh>crt.sh</a></p></li><li><p><a href=https://transparencyreport.google.com/https/certificates>Google&rsquo;s Certificate Transparency</a></p></li></ul></div><footer class=post-footer><nav class=paginav><a class=prev href=https://gokoururi.com/posts/2/><span class=title>« Prev Page</span><br><span>Deploy V2Ray</span></a></nav></footer></article></main><footer class=footer><span>© 2020-2022 <a href=/>Smile&rsquo;s Blog</a> (<a href=/about/#license>License</a> under <a href=https://creativecommons.org/licenses/by-nc-sa/4.0/>BY-NC-SA 4.0</a>)</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>